<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>GameStream | Admin</title>
    <style>
        body { background: #0e0e10; color: white; font-family: sans-serif; padding: 40px; }
        .container { max-width: 1000px; margin: 0 auto; }
        h1 { color: #9146ff; border-bottom: 2px solid #2f2f35; padding-bottom: 10px; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; background: #18181b; }
        th, td { padding: 15px; border: 1px solid #2f2f35; text-align: left; }
        th { color: #adadb8; text-transform: uppercase; font-size: 0.8rem; }
        .btn { padding: 8px 12px; border: none; border-radius: 4px; cursor: pointer; font-weight: bold; }
        .btn-del { background: #ff4444; color: white; }
        .btn-ban { background: #ff8c00; color: white; margin-left: 5px; }
        .login-box { text-align: center; margin-top: 100px; }
        input { background: #2f2f35; border: 1px solid #9146ff; color: white; padding: 10px; border-radius: 4px; width: 250px; }
    </style>
</head>
<body>
    <div class="container">
        <div id="login-zone" class="login-box">
            <h1>Accès Restreint</h1>
            <input type="password" id="admin-secret" placeholder="Entrez le code secret...">
            <button class="btn" style="background:#9146ff; color:white;" onclick="loadUsers()">Valider</button>
        </div>

        <div id="admin-zone" style="display:none;">
            <h1>Gestion des Utilisateurs</h1>
            <table>
                <thead>
                    <tr>
                        <th>Pseudo</th>
                        <th>Email</th>
                        <th>Adresse IP</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="user-list"></tbody>
            </table>
        </div>
    </div>

    <script>
        let currentSecret = "";
        async function loadUsers() {
            currentSecret = document.getElementById('admin-secret').value;
            const res = await fetch('/api/admin/users', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ secret: currentSecret })
            });
            const data = await res.json();
            if(data.success) {
                document.getElementById('login-zone').style.display = 'none';
                document.getElementById('admin-zone').style.display = 'block';
                render(data.users);
            } else { alert("Code incorrect"); }
        }

        function render(users) {
            const list = document.getElementById('user-list');
            list.innerHTML = users.map(u => `
                <tr>
                    <td>${u.username}</td>
                    <td>${u.email}</td>
                    <td style="font-family:monospace; color:#adadb8;">${u.ip}</td>
                    <td>
                        <button class="btn btn-del" onclick="deleteUser(${u.id})">Supprimer</button>
                        <button class="btn btn-ban" onclick="banIp('${u.ip}')">Ban IP</button>
                    </td>
                </tr>
            `).join('');
        }

        async function deleteUser(id) {
            if(confirm("Supprimer ce compte ?")) {
                await fetch('/api/admin/delete-user', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ secret: currentSecret, userId: id })
                });
                loadUsers();
            }
        }

        async function banIp(ip) {
            if(confirm("Bannir cette IP définitivement ?")) {
                await fetch('/api/admin/ban-ip', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ secret: currentSecret, ip: ip })
                });
                alert("IP bannie !");
                loadUsers();
            }
        }
    </script>
</body>
</html>