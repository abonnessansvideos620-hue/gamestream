<!DOCTYPE html>
<html>
<head><meta charset="UTF-8"><title>Admin - GameStream</title>
<link rel="stylesheet" href="style.css">
<style>
.admin-topbar{background:#0f0f1a;border-bottom:1px solid #1e1e30;padding:14px 28px;display:flex;justify-content:space-between;align-items:center;height:52px}
.admin-topbar h1{font-size:1.1rem;font-weight:700}.admin-topbar span{color:#00ff00}
.admin-badge{background:rgba(0,255,0,0.15);border:1px solid rgba(0,255,0,0.3);color:#00ff00;padding:5px 14px;border-radius:20px;font-size:12px;font-weight:600}
.admin-layout{display:flex;height:calc(100vh - 52px)}
.admin-sidebar{width:220px;background:#0f0f1a;border-right:1px solid #1e1e30;padding:20px 12px;overflow-y:auto}
.admin-nav-item{display:flex;align-items:center;gap:10px;padding:10px 14px;border-radius:8px;cursor:pointer;color:#64748b;font-weight:600;transition:0.15s;margin-bottom:4px}
.admin-nav-item:hover{background:rgba(255,255,255,0.04);color:#efeff1}
.admin-nav-item.active{background:rgba(0,255,0,0.15);color:#00ff00}
.admin-content{flex:1;overflow-y:auto;padding:24px 28px}
.admin-page{display:none}.admin-page.active{display:block}
#admin-page-chat{display:none;flex-direction:column;height:100%;padding:0}
#admin-page-chat.active{display:flex}
.admin-card{background:#0f0f1a;border:1px solid #1e1e30;border-radius:10px;padding:20px;margin-bottom:16px}
.admin-stats{display:flex;gap:12px;flex-wrap:wrap;margin-bottom:20px}
.admin-stat{flex:1;min-width:180px;background:#0f0f1a;border:1px solid #1e1e30;border-radius:10px;padding:16px;text-align:center}
.admin-stat-num{font-size:1.8rem;font-weight:700;color:#00ff00}
.admin-stat-label{color:#64748b;font-size:11px;text-transform:uppercase;margin-top:4px}
.admin-table{width:100%;border-collapse:collapse;font-size:12px}
.admin-table th,.admin-table td{padding:11px 14px;border-bottom:1px solid #1e1e30;text-align:left}
.admin-table th{color:#64748b;text-transform:uppercase;font-size:10px;font-weight:700;background:rgba(255,255,255,0.02)}
.admin-table tr:hover td{background:rgba(255,255,255,0.02)}
.admin-btn{display:inline-flex;align-items:center;gap:5px;padding:6px 12px;border:none;border-radius:6px;cursor:pointer;font-weight:600;font-size:12px;transition:0.15s}
.admin-btn-green{background:rgba(0,255,0,0.15);color:#00ff00;border:1px solid rgba(0,255,0,0.2)}
.admin-btn-red{background:rgba(239,68,68,0.15);color:#ef4444;border:1px solid rgba(239,68,68,0.2)}
.admin-btn-orange{background:rgba(251,191,36,0.15);color:#fbbf24;border:1px solid rgba(251,191,36,0.2)}
.admin-modal{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.85);z-index:9999;display:none;align-items:center;justify-content:center}
.admin-modal-content{background:#0f0f1a;border:1px solid #2f2f45;border-radius:14px;padding:28px;max-width:420px;width:90%;max-height:90vh;overflow-y:auto}
.admin-modal input,.admin-modal textarea,.admin-modal select{width:100%;padding:10px 14px;background:#12121f;border:1px solid #2f2f45;border-radius:8px;color:#efeff1;font-size:13px;margin-bottom:14px}
.admin-login{position:fixed;top:0;left:0;width:100%;height:100%;background:#080810;display:flex;align-items:center;justify-content:center;z-index:999}
.admin-login-box{background:#0f0f1a;border:1px solid #1e1e30;border-radius:16px;padding:40px;max-width:400px;width:90%;text-align:center}
.admin-login-box input{width:100%;padding:12px 16px;background:#12121f;border:1px solid #2f2f45;border-radius:8px;color:#efeff1;font-size:14px;margin-bottom:12px}
.admin-login-box button{width:100%;padding:12px;background:#00ff00;color:#000;border:none;border-radius:8px;font-weight:700;cursor:pointer;font-size:14px}
.admin-chat-box{flex:1;background:#0f0f1a;border:1px solid #1e1e30;border-radius:10px;overflow:hidden;display:flex;flex-direction:column;min-height:0}
.admin-chat-messages{flex:1;overflow-y:auto;padding:12px;display:flex;flex-direction:column;gap:3px}
.admin-chat-input{display:flex;gap:8px;padding:12px 16px;background:#12121f;border-top:1px solid #1e1e30}
.admin-chat-input input{flex:1;padding:10px;background:#0e0e10;border:1px solid #2f2f45;border-radius:6px;color:#efeff1}
.badge{display:inline-flex;padding:3px 10px;border-radius:20px;font-size:11px;font-weight:700}
.badge-ip{background:rgba(251,191,36,0.15);color:#fbbf24}
.badge-hw{background:rgba(239,68,68,0.15);color:#ef4444}
.badge-active{background:rgba(0,255,0,0.15);color:#00ff00}
.badge-offline{background:rgba(100,116,139,0.15);color:#64748b}
</style>
</head>
<body>

<!-- LOGIN SCREEN -->
<div id="admin-login-screen" class="admin-login">
<div class="admin-login-box">
<h2>ğŸ® Administration</h2>
<p id="admin-login-mode-text" style="color:#64748b;margin:16px 0">PremiÃ¨re connexion ? CrÃ©e ton compte admin</p>
<div id="admin-register-form">
<input type="text" id="admin-reg-name" placeholder="Ton nom (ex: Alexandre)">
<input type="password" id="admin-reg-key" placeholder="ClÃ© admin (ADMIN_KEY ou SUPER_ADMIN_KEY)">
<input type="password" id="admin-reg-password" placeholder="Choisis un mot de passe">
<div id="admin-reg-error" style="color:#ef4444;font-size:12px;margin-bottom:12px;display:none"></div>
<button onclick="adminRegister()">CrÃ©er mon compte admin</button>
<p class="admin-login-toggle" onclick="toggleAdminLoginMode()">DÃ©jÃ  un compte ? <span style="color:#00ff00">Se connecter</span></p>
</div>
<div id="admin-login-form" style="display:none">
<input type="text" id="admin-login-id" placeholder="Ton ID admin (ex: ADMIN_0001)">
<input type="password" id="admin-login-password" placeholder="Ton mot de passe">
<div id="admin-login-error" style="color:#ef4444;font-size:12px;margin-bottom:12px;display:none"></div>
<button onclick="adminLogin()">Connexion</button>
<p class="admin-login-toggle" onclick="toggleAdminLoginMode()">Pas encore de compte ? <span style="color:#00ff00">CrÃ©er</span></p>
</div>
</div>
</div>

<!-- ADMIN PANEL -->
<div id="admin-main-panel" style="display:none;height:100vh;flex-direction:column">
<div class="admin-topbar">
<h1>Game<span>Stream</span> Admin</h1>
<div class="admin-badge" id="admin-display-name">Admin</div>
</div>

<div class="admin-layout">
<!-- SIDEBAR -->
<nav class="admin-sidebar">
<div class="admin-nav-item active" onclick="showAdminPage('dashboard',this)">ğŸ“Š Dashboard</div>
<div class="admin-nav-item" onclick="showAdminPage('users',this);loadAdminUsers()">ğŸ‘¥ Utilisateurs</div>
<div class="admin-nav-item" onclick="showAdminPage('bans',this);loadAdminBans()">ğŸ”¨ Bans <span id="admin-bans-count" class="admin-badge" style="margin-left:auto">0</span></div>
<div class="admin-nav-item" onclick="showAdminPage('chat',this)">ğŸ’¬ Chat</div>
<div class="admin-nav-item" onclick="showAdminPage('dm-spy',this);loadAdminDMs()">ğŸ•µï¸ DM Spy</div>
<div class="admin-nav-item" onclick="showAdminPage('word-filter',this);loadAdminWordFilter()">ğŸš« Filtres</div>
<div class="admin-nav-item" onclick="showAdminPage('timeouts',this);loadAdminTimeouts()">â° Timeouts</div>
<div class="admin-nav-item" onclick="showAdminPage('logs',this);loadAdminLogs()">ğŸ“‹ Logs</div>
<div class="admin-nav-item" onclick="showAdminPage('rankings',this);loadAdminRankings()">ğŸ† Classement</div>
<div class="admin-nav-item" onclick="showAdminPage('grades',this);loadAdminRankings()">â­ Grades</div>
<div class="admin-nav-item" id="admin-nav-super" style="display:none" onclick="showAdminPage('superadmin',this);loadSuperAdmin()">ğŸ‘‘ Super Admin</div>
<div class="admin-nav-item" onclick="showAdminPage('help',this)">â“ Aide</div>
</nav>

<!-- CONTENT -->
<div class="admin-content">
<!-- DASHBOARD -->
<div id="admin-page-dashboard" class="admin-page active">
<h2 style="font-size:1.1rem;font-weight:700;margin-bottom:20px;display:flex;align-items:center;gap:8px"><span style="width:3px;height:18px;background:#00ff00;border-radius:2px"></span>Dashboard</h2>
<div class="admin-stats">
<div class="admin-stat"><div class="admin-stat-num" id="admin-stat-users">â€”</div><div class="admin-stat-label">Utilisateurs</div></div>
<div class="admin-stat"><div class="admin-stat-num" id="admin-stat-online">â€”</div><div class="admin-stat-label">En ligne</div></div>
<div class="admin-stat"><div class="admin-stat-num" id="admin-stat-bans">â€”</div><div class="admin-stat-label">Bans actifs</div></div>
<div class="admin-stat"><div class="admin-stat-num" id="admin-stat-hw">â€”</div><div class="admin-stat-label">Bans matÃ©riels</div></div>
</div>
<div class="admin-card">
<h3 style="font-size:0.75rem;text-transform:uppercase;color:#64748b;font-weight:700;margin-bottom:14px">Derniers bans</h3>
<table class="admin-table"><thead><tr><th>Utilisateur</th><th>Type</th><th>Raison</th><th>Admin</th><th>Date</th></tr></thead>
<tbody id="admin-recent-bans"><tr><td colspan="5" style="text-align:center;padding:32px;color:#64748b">Aucun ban</td></tr></tbody></table>
</div>
</div>

<!-- AUTRES PAGES (simplifiÃ© pour gagner de la place) -->
<div id="admin-page-users" class="admin-page"><h2 style="font-size:1.1rem;font-weight:700;margin-bottom:20px;display:flex;align-items:center;gap:8px"><span style="width:3px;height:18px;background:#00ff00;border-radius:2px"></span>Utilisateurs</h2><div class="admin-card"><table class="admin-table"><thead><tr><th>Pseudo</th><th>Grade</th><th>IP</th><th>Statut</th><th>Actions</th></tr></thead><tbody id="admin-user-list"></tbody></table></div></div>

<div id="admin-page-bans" class="admin-page"><h2 style="font-size:1.1rem;font-weight:700;margin-bottom:20px;display:flex;align-items:center;gap:8px"><span style="width:3px;height:18px;background:#00ff00;border-radius:2px"></span>Registre des Bans</h2><div class="admin-card"><table class="admin-table"><thead><tr><th>Utilisateur</th><th>Type</th><th>Raison</th><th>Admin</th><th>Date</th><th>Actions</th></tr></thead><tbody id="admin-ban-list"></tbody></table></div></div>

<div id="admin-page-dm-spy" class="admin-page"><h2 style="font-size:1.1rem;font-weight:700;margin-bottom:20px;display:flex;align-items:center;gap:8px"><span style="width:3px;height:18px;background:#00ff00;border-radius:2px"></span>DM Spy</h2><div class="admin-card"><table class="admin-table"><thead><tr><th>De</th><th>Ã€</th><th>Message</th><th>Date</th></tr></thead><tbody id="admin-dm-list"></tbody></table></div></div>

<div id="admin-page-word-filter" class="admin-page"><h2 style="font-size:1.1rem;font-weight:700;margin-bottom:20px;display:flex;align-items:center;gap:8px"><span style="width:3px;height:18px;background:#00ff00;border-radius:2px"></span>Filtres de Mots</h2><div class="admin-card"><div id="admin-word-list" style="display:flex;flex-wrap:wrap;gap:8px;margin-bottom:16px"></div><div style="display:flex;gap:8px"><input id="admin-new-word" placeholder="Ajouter un mot interdit..." style="flex:1;padding:10px;background:#12121f;border:1px solid #2f2f45;border-radius:8px;color:#efeff1"><button class="admin-btn admin-btn-red" onclick="adminAddWord()">Ajouter</button></div></div></div>

<div id="admin-page-timeouts" class="admin-page"><h2 style="font-size:1.1rem;font-weight:700;margin-bottom:20px;display:flex;align-items:center;gap:8px"><span style="width:3px;height:18px;background:#00ff00;border-radius:2px"></span>Timeouts Actifs</h2><div class="admin-card"><table class="admin-table"><thead><tr><th>Utilisateur</th><th>DurÃ©e</th><th>Raison</th><th>Admin</th><th>Expire</th></tr></thead><tbody id="admin-timeout-list"></tbody></table></div></div>

<div id="admin-page-logs" class="admin-page"><h2 style="font-size:1.1rem;font-weight:700;margin-bottom:20px;display:flex;align-items:center;gap:8px"><span style="width:3px;height:18px;background:#00ff00;border-radius:2px"></span>Logs Admin</h2><div class="admin-card"><table class="admin-table"><thead><tr><th>Admin</th><th>Action</th><th>Cible</th><th>DÃ©tails</th><th>Date</th></tr></thead><tbody id="admin-log-list"></tbody></table></div></div>

<div id="admin-page-rankings" class="admin-page"><h2 style="font-size:1.1rem;font-weight:700;margin-bottom:20px;display:flex;align-items:center;gap:8px"><span style="width:3px;height:18px;background:#00ff00;border-radius:2px"></span>Classement Viewers</h2><div class="admin-card"><table class="admin-table"><thead><tr><th>#</th><th>Pseudo</th><th>Grade</th><th>Heures</th></tr></thead><tbody id="admin-ranking-list"></tbody></table></div></div>

<div id="admin-page-grades" class="admin-page"><h2 style="font-size:1.1rem;font-weight:700;margin-bottom:20px;display:flex;align-items:center;gap:8px"><span style="width:3px;height:18px;background:#00ff00;border-radius:2px"></span>SystÃ¨me de Grades</h2><div class="admin-card"><table class="admin-table"><thead><tr><th>Pseudo</th><th>Grade</th><th>Heures</th></tr></thead><tbody id="admin-grade-list"></tbody></table></div></div>

<div id="admin-page-superadmin" class="admin-page"><h2 style="font-size:1.1rem;font-weight:700;margin-bottom:20px;display:flex;align-items:center;gap:8px"><span style="width:3px;height:18px;background:#00ff00;border-radius:2px"></span>ğŸ‘‘ Super Admin</h2><div class="admin-card"><h3 style="font-size:0.75rem;text-transform:uppercase;color:#64748b;font-weight:700;margin-bottom:14px">Liste des Admins</h3><table class="admin-table"><thead><tr><th>ID</th><th>Nom</th><th>RÃ´le</th><th>Mot de passe</th><th>Total Actions</th><th>DerniÃ¨re Connexion</th></tr></thead><tbody id="admin-superadmin-list"></tbody></table></div></div>

<div id="admin-page-help" class="admin-page">
<h2 style="font-size:1.1rem;font-weight:700;margin-bottom:20px;display:flex;align-items:center;gap:8px"><span style="width:3px;height:18px;background:#00ff00;border-radius:2px"></span>Aide & Documentation</h2>
<div style="background:#0f0f1a;border:1px solid #1e1e30;border-left:3px solid #00ff00;border-radius:10px;padding:18px 20px;margin-bottom:20px;line-height:1.7;color:#adadb8">
<h3 style="color:#efeff1;font-size:14px;margin-bottom:12px;font-weight:700">ğŸ›ï¸ FonctionnalitÃ©s du Panel Admin</h3>
<ul style="padding-left:20px">
<li style="margin-bottom:8px"><strong style="color:#00ff00">Dashboard</strong> â€” Statistiques globales et derniers bans</li>
<li style="margin-bottom:8px"><strong style="color:#00ff00">Utilisateurs</strong> â€” GÃ©rer, bannir, timeout, supprimer les comptes</li>
<li style="margin-bottom:8px"><strong style="color:#00ff00">Bans</strong> â€” Registre complet de tous les bans (IP + matÃ©riel). Tu peux unban n'importe quel type de ban.</li>
<li style="margin-bottom:8px"><strong style="color:#00ff00">Chat</strong> â€” ContrÃ´les (lock/reset), envoyer des messages en tant qu'admin, Ã©pingler des messages</li>
<li style="margin-bottom:8px"><strong style="color:#00ff00">DM Spy</strong> â€” Voir TOUTES les conversations privÃ©es entre utilisateurs</li>
<li style="margin-bottom:8px"><strong style="color:#00ff00">Filtres</strong> â€” Ajouter/supprimer des mots bannis automatiquement</li>
<li style="margin-bottom:8px"><strong style="color:#00ff00">Timeouts</strong> â€” Bans temporaires (10min, 1h, 1 jour, 1 semaine)</li>
<li style="margin-bottom:8px"><strong style="color:#00ff00">Logs</strong> â€” Historique de toutes tes actions (bans, unbans, etc.)</li>
<li style="margin-bottom:8px"><strong style="color:#00ff00">Classement</strong> â€” Top 50 viewers par temps de visionnage (exclut bannis/supprimÃ©s)</li>
<li style="margin-bottom:8px"><strong style="color:#00ff00">Grades</strong> â€” SystÃ¨me automatique : Viewerâ†’FidÃ¨leâ†’Braveâ†’GOATâ†’STARS</li>
</ul>
</div>
<div style="background:#0f0f1a;border:1px solid #1e1e30;border-left:3px solid #00ff00;border-radius:10px;padding:18px 20px;margin-bottom:20px;line-height:1.7;color:#adadb8">
<h3 style="color:#efeff1;font-size:14px;margin-bottom:12px;font-weight:700">ğŸ›¡ï¸ Messages Admin</h3>
<p>Quand tu envoies un message depuis le panel, les utilisateurs voient "<strong style="color:#ef4444">ADMIN ğŸ›¡ï¸</strong>" en rouge/gras/brillant. Ton vrai nom reste anonyme.</p>
</div>
<div style="background:#0f0f1a;border:1px solid #1e1e30;border-left:3px solid #00ff00;border-radius:10px;padding:18px 20px;margin-bottom:20px;line-height:1.7;color:#adadb8">
<h3 style="color:#efeff1;font-size:14px;margin-bottom:12px;font-weight:700">ğŸ“Œ Messages Ã‰pinglÃ©s</h3>
<p>Tu peux Ã©pingler un message en haut du chat visible par tous. DurÃ©es : 5min, 10min, 1h, 2h, 3h, ou lifetime.</p>
</div>
<div style="background:#0f0f1a;border:1px solid #1e1e30;border-left:3px solid #00ff00;border-radius:10px;padding:18px 20px;line-height:1.7;color:#adadb8">
<h3 style="color:#efeff1;font-size:14px;margin-bottom:12px;font-weight:700">ğŸ” SystÃ¨me de Comptes Admin</h3>
<p>PremiÃ¨re connexion : utilise la <strong>ADMIN_KEY</strong> pour crÃ©er ton compte. Tu reÃ§ois un ID unique (ADMIN_0001, ADMIN_0002...). Ensuite, connecte-toi avec ton ID + ton mot de passe.</p>
<p style="margin-top:12px"><strong style="color:#ef4444">Super Admin :</strong> Si tu as la SUPER_ADMIN_KEY, tu as accÃ¨s Ã  l'onglet ğŸ‘‘ Super Admin oÃ¹ tu peux voir TOUS les admins, leurs mots de passe, et tous leurs logs.</p>
</div>
</div>

</div>

<!-- CHAT PAGE (layout spÃ©cial) -->
<div id="admin-page-chat" class="admin-page">
<div style="padding:24px 28px;display:flex;flex-direction:column;height:100%">
<h2 style="font-size:1.1rem;font-weight:700;margin-bottom:16px;display:flex;align-items:center;gap:8px"><span style="width:3px;height:18px;background:#00ff00;border-radius:2px"></span>ğŸ’¬ Gestion du Chat</h2>
<div class="admin-card" style="flex-shrink:0">
<div style="display:flex;gap:12px;align-items:center;flex-wrap:wrap">
<span id="admin-lock-status" style="padding:6px 16px;border-radius:20px;font-size:12px;font-weight:700;background:rgba(0,255,0,0.15);color:#00ff00;border:1px solid rgba(0,255,0,0.2)">ğŸ”“ Chat ouvert</span>
<button class="admin-btn admin-btn-orange" onclick="adminResetChat()">ğŸ—‘ï¸ RÃ©initialiser</button>
<button id="admin-btn-lock" class="admin-btn admin-btn-red" onclick="adminToggleLock()">ğŸ”’ Verrouiller</button>
<button class="admin-btn admin-btn-green" onclick="showPinMessageModal()">ğŸ“Œ Ã‰pingler message</button>
</div>
</div>
<div class="admin-chat-box" style="flex:1;min-height:0">
<div style="display:flex;align-items:center;justify-content:space-between;padding:12px 16px;background:#12121f;border-bottom:1px solid #1e1e30">
<div style="font-size:0.75rem;text-transform:uppercase;color:#64748b;font-weight:700">Messages en direct <span style="display:inline-flex;align-items:center;gap:5px;background:rgba(239,68,68,0.1);border:1px solid rgba(239,68,68,0.2);color:#ef4444;padding:3px 10px;border-radius:20px;font-size:10px;margin-left:8px"><span style="width:5px;height:5px;background:#ef4444;border-radius:50%;animation:pulse 1.5s infinite"></span>LIVE</span></div>
<div style="display:inline-flex;align-items:center;gap:5px;background:rgba(0,255,0,0.1);border:1px solid rgba(0,255,0,0.2);color:#00ff00;padding:4px 10px;border-radius:20px;font-size:11px;font-weight:600"><span style="width:5px;height:5px;background:#00ff00;border-radius:50%"></span><span id="admin-online-count">0</span> en ligne</div>
</div>
<div class="admin-chat-messages" id="admin-chat-messages"><div style="text-align:center;padding:32px;color:#64748b;font-size:11px;font-style:italic">â€” En attente de messages â€”</div></div>
<div class="admin-chat-input">
<input id="admin-chat-input" placeholder="Ã‰crire en tant qu'ADMIN ğŸ›¡ï¸..." onkeydown="if(event.key==='Enter')adminSendMessage()">
<button class="admin-btn admin-btn-green" onclick="adminSendMessage()">Envoyer</button>
</div>
</div>
</div>
</div>

</div>
</div>
</div>

<!-- MODALS -->
<div id="admin-modal-ban" class="admin-modal"><div class="admin-modal-content"><h3 id="admin-modal-ban-title">Ban</h3><div style="background:#12121f;border:1px solid #2f2f45;border-radius:8px;padding:10px 14px;margin-bottom:16px"><div style="font-size:10px;color:#64748b;text-transform:uppercase">Cible</div><div id="admin-modal-ban-target" style="color:#efeff1;font-weight:600;margin-top:2px">â€”</div></div><label style="display:block;color:#adadb8;font-size:12px;margin-bottom:5px;font-weight:600">Raison *</label><textarea id="admin-modal-ban-reason" rows="3" style="resize:none"></textarea><div id="admin-modal-ban-error" style="color:#ef4444;font-size:12px;margin-bottom:12px;display:none"></div><div style="display:flex;gap:10px;justify-content:flex-end"><button class="admin-btn admin-btn-green" onclick="closeAdminBanModal()">Annuler</button><button class="admin-btn admin-btn-red" onclick="confirmAdminBan()">Appliquer</button></div></div></div>

<div id="admin-modal-timeout" class="admin-modal"><div class="admin-modal-content"><h3>â° Timeout</h3><div style="background:#12121f;border:1px solid #2f2f45;border-radius:8px;padding:10px 14px;margin-bottom:16px"><div style="font-size:10px;color:#64748b;text-transform:uppercase">Utilisateur</div><div id="admin-modal-timeout-target" style="color:#efeff1;font-weight:600;margin-top:2px">â€”</div></div><label style="display:block;color:#adadb8;font-size:12px;margin-bottom:5px;font-weight:600">DurÃ©e</label><select id="admin-modal-timeout-duration"><option value="10">10 minutes</option><option value="60">1 heure</option><option value="1440">1 jour</option><option value="10080">1 semaine</option></select><label style="display:block;color:#adadb8;font-size:12px;margin-bottom:5px;font-weight:600">Raison *</label><textarea id="admin-modal-timeout-reason" rows="2" style="resize:none"></textarea><div id="admin-modal-timeout-error" style="color:#ef4444;font-size:12px;margin-bottom:12px;display:none"></div><div style="display:flex;gap:10px;justify-content:flex-end"><button class="admin-btn admin-btn-green" onclick="closeAdminTimeoutModal()">Annuler</button><button class="admin-btn admin-btn-red" onclick="confirmAdminTimeout()">Appliquer</button></div></div></div>

<div id="admin-modal-pin" class="admin-modal"><div class="admin-modal-content"><h3>ğŸ“Œ Ã‰pingler un Message</h3><label style="display:block;color:#adadb8;font-size:12px;margin-bottom:5px;font-weight:600">Message *</label><textarea id="admin-modal-pin-text" rows="3" placeholder="Message Ã  Ã©pingler en haut du chat..." style="resize:none"></textarea><label style="display:block;color:#adadb8;font-size:12px;margin-bottom:5px;font-weight:600">DurÃ©e</label><select id="admin-modal-pin-duration"><option value="5">5 minutes</option><option value="10">10 minutes</option><option value="60">1 heure</option><option value="120">2 heures</option><option value="180">3 heures</option><option value="lifetime">Permanent</option></select><div id="admin-modal-pin-error" style="color:#ef4444;font-size:12px;margin-bottom:12px;display:none"></div><div style="display:flex;gap:10px;justify-content:flex-end"><button class="admin-btn admin-btn-green" onclick="closePinMessageModal()">Annuler</button><button class="admin-btn admin-btn-red" onclick="confirmPinMessage()">Ã‰pingler</button></div></div></div>

<script src="/socket.io/socket.io.js"></script>
<script>
// Variables globales
let adminData={id:'',name:'',role:''};
let allUsers=[],allBans=[],chatLocked=false,pendingBan=null,pendingTimeout=null;
const socket=io();

// Socket events
socket.on('new-message',msg=>appendAdminChatMsg(msg));
socket.on('chat-reset',()=>{document.getElementById('admin-chat-messages').innerHTML='<div style="text-align:center;padding:32px;color:#64748b;font-size:11px;font-style:italic">â€” Chat rÃ©initialisÃ© â€”</div>'});
socket.on('chat-lock',locked=>{chatLocked=locked;updateAdminLockUI()});
socket.on('viewers-update',count=>{document.getElementById('admin-online-count').textContent=count});
socket.on('load-history',history=>{const b=document.getElementById('admin-chat-messages');b.innerHTML='';if(!history.length){b.innerHTML='<div style="text-align:center;padding:32px;color:#64748b;font-size:11px;font-style:italic">â€” Aucun message â€”</div>';return}history.forEach(appendAdminChatMsg)});

function appendAdminChatMsg(msg){
const box=document.getElementById('admin-chat-messages');
const waiting=box.querySelector('div[style*="attente"]');
if(waiting)waiting.remove();
const div=document.createElement('div');
div.style.cssText='padding:5px 8px;border-radius:6px;font-size:12px;line-height:1.5;display:flex;gap:6px;margin-bottom:2px;'+(msg.isAdmin?'border:2px solid #ef4444;background:rgba(239,68,68,0.1)':'');
div.innerHTML=`<span style="color:#374151;font-size:10px">${msg.time}</span><span style="color:${msg.isAdmin?'#ef4444':'#00ff00'};font-weight:700">${esc(msg.user)}</span><span style="color:#e2e8f0">${esc(msg.text)}</span>`;
box.appendChild(div);
box.scrollTop=box.scrollHeight;
while(box.children.length>200)box.removeChild(box.firstChild)
}

// Login/Register
function toggleAdminLoginMode(){
const reg=document.getElementById('admin-register-form');
const log=document.getElementById('admin-login-form');
const txt=document.getElementById('admin-login-mode-text');
if(reg.style.display==='none'){reg.style.display='';log.style.display='none';txt.textContent='PremiÃ¨re connexion ? CrÃ©e ton compte admin'}
else{reg.style.display='none';log.style.display='';txt.textContent='DÃ©jÃ  un compte ? Connecte-toi'}
}

async function adminRegister(){
const name=document.getElementById('admin-reg-name').value.trim();
const key=document.getElementById('admin-reg-key').value.trim();
const password=document.getElementById('admin-reg-password').value.trim();
const err=document.getElementById('admin-reg-error');
if(!name||!key||!password){err.textContent='Remplis tous les champs';err.style.display='block';return}
try{
const res=await fetch('/api/admin/register',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({adminKey:key,name,password})});
const data=await res.json();
if(data.success){alert(`âœ… Compte crÃ©Ã© !\nTon ID : ${data.admin.id}\nRetiens-le pour te connecter.`);adminData=data.admin;initAdminPanel()}
else{err.textContent=data.error||'Erreur';err.style.display='block'}
}catch{err.textContent='Erreur serveur';err.style.display='block'}
}

async function adminLogin(){
const id=document.getElementById('admin-login-id').value.trim();
const password=document.getElementById('admin-login-password').value.trim();
const err=document.getElementById('admin-login-error');
if(!id||!password){err.textContent='Remplis tous les champs';err.style.display='block';return}
try{
const res=await fetch('/api/admin/login',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({adminId:id,password})});
const data=await res.json();
if(data.success){adminData=data.admin;initAdminPanel()}
else{err.textContent=data.error||'Erreur';err.style.display='block'}
}catch{err.textContent='Erreur serveur';err.style.display='block'}
}

function initAdminPanel(){
document.getElementById('admin-login-screen').style.display='none';
document.getElementById('admin-main-panel').style.display='flex';
document.getElementById('admin-display-name').textContent=`${adminData.role==='super_admin'?'ğŸ‘‘ ':''}${adminData.name} (${adminData.id})`;
if(adminData.role==='super_admin')document.getElementById('admin-nav-super').style.display='flex';
loadAdminUsers();
loadAdminBans();
const statusData=fetch('/api/chat-status').then(r=>r.json()).then(d=>{chatLocked=d.locked;updateAdminLockUI()});
}

// Navigation
function showAdminPage(id,el){
document.querySelectorAll('.admin-page').forEach(p=>p.classList.remove('active'));
document.querySelectorAll('.admin-nav-item').forEach(i=>i.classList.remove('active'));
document.getElementById('admin-page-'+id).classList.add('active');
if(el)el.classList.add('active')
}

// Users
async function loadAdminUsers(){
const res=await fetch('/api/admin/users',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({adminId:adminData.id})});
const data=await res.json();
allUsers=data.users;
document.getElementById('admin-stat-users').textContent=allUsers.length;
document.getElementById('admin-stat-online').textContent=allUsers.filter(u=>u.isOnline).length;
const tbody=document.getElementById('admin-user-list');
if(!allUsers.length){tbody.innerHTML='<tr><td colspan="5" style="text-align:center;padding:32px;color:#64748b">Aucun utilisateur</td></tr>';return}
tbody.innerHTML=allUsers.map(u=>`<tr><td><strong>${esc(u.username)}</strong><br><span style="color:#64748b;font-size:11px">${esc(u.email)}</span></td><td><span style="color:${u.grade?.color||'#888'};font-weight:700">${u.grade?.icon||'ğŸ‘ï¸'} ${u.grade?.name||'Viewer'}</span></td><td style="font-family:monospace;font-size:11px;color:#00ff00">${u.ip||'â€”'}</td><td>${u.isOnline?'<span class="badge badge-active">â— En ligne</span>':'<span class="badge badge-offline">Hors ligne</span>'}</td><td>${!u.activeBan?`<button class="admin-btn admin-btn-red" onclick="openAdminBanModal('ip',${u.id},'${esc(u.ip)}','${esc(u.username)}')">Ban IP</button><button class="admin-btn admin-btn-red" onclick="openAdminBanModal('hardware',${u.id},'${esc(u.ip)}','${esc(u.username)}')">ğŸ”¨ Ban HW</button><button class="admin-btn admin-btn-orange" onclick="openAdminTimeoutModal('${esc(u.username)}')">â° Timeout</button>`:`<button class="admin-btn admin-btn-green" onclick="adminUnban(${u.activeBan.id},'${esc(u.username)}')">ğŸ”“ Lever</button>`}</td></tr>`).join('')
}

// Bans
async function loadAdminBans(){
const res=await fetch('/api/admin/bans',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({adminId:adminData.id})});
const data=await res.json();
allBans=data.bans||[];
document.getElementById('admin-bans-count').textContent=allBans.length;
document.getElementById('admin-stat-bans').textContent=allBans.length;
document.getElementById('admin-stat-hw').textContent=allBans.filter(b=>b.type==='hardware').length;
const tbody=document.getElementById('admin-ban-list');
if(!allBans.length){tbody.innerHTML='<tr><td colspan="6" style="text-align:center;padding:32px;color:#64748b">Aucun ban</td></tr>';return}
const sorted=[...allBans].sort((a,b)=>b.createdAt-a.createdAt);
tbody.innerHTML=sorted.map(b=>`<tr><td><strong>${esc(b.username||'â€”')}</strong></td><td>${b.type==='hardware'?'<span class="badge badge-hw">ğŸ”¨ MatÃ©riel</span>':'<span class="badge badge-ip">ğŸ“¡ IP</span>'}</td><td>${esc(b.reason)}</td><td style="color:#00ff00;font-weight:600">${esc(b.adminName)}</td><td style="color:#64748b">${frDate(b.createdAt)}</td><td><button class="admin-btn admin-btn-green" onclick="adminUnban(${b.id},'${esc(b.username||b.ip)}')">ğŸ”“ Lever</button></td></tr>`).join('');
const recentTbody=document.getElementById('admin-recent-bans');
const recent=sorted.slice(0,5);
if(!recent.length){recentTbody.innerHTML='<tr><td colspan="5" style="text-align:center;padding:32px;color:#64748b">Aucun ban</td></tr>';return}
recentTbody.innerHTML=recent.map(b=>`<tr><td>${esc(b.username||'â€”')}</td><td>${b.type==='hardware'?'<span class="badge badge-hw">ğŸ”¨</span>':'<span class="badge badge-ip">ğŸ“¡</span>'}</td><td>${esc(b.reason)}</td><td style="color:#00ff00">${esc(b.adminName)}</td><td style="color:#64748b">${frDate(b.createdAt)}</td></tr>`).join('')
}

function openAdminBanModal(type,userId,ip,username){
pendingBan={type,userId,ip,username};
document.getElementById('admin-modal-ban-title').textContent=type==='hardware'?'ğŸ”¨ Ban MatÃ©riel':'ğŸ“¡ Ban IP';
document.getElementById('admin-modal-ban-target').innerHTML=`<strong>${esc(username)}</strong> â€” ${esc(ip)}`;
document.getElementById('admin-modal-ban-reason').value='';
document.getElementById('admin-modal-ban-error').style.display='none';
document.getElementById('admin-modal-ban').style.display='flex'
}

function closeAdminBanModal(){document.getElementById('admin-modal-ban').style.display='none';pendingBan=null}

async function confirmAdminBan(){
const reason=document.getElementById('admin-modal-ban-reason').value.trim();
const err=document.getElementById('admin-modal-ban-error');
if(!reason){err.textContent='Raison requise';err.style.display='block';return}
const url=pendingBan.type==='ip'?'/api/admin/ban-ip':'/api/admin/ban-hardware';
const body=pendingBan.type==='ip'?{adminId:adminData.id,ip:pendingBan.ip,username:pendingBan.username,reason}:{adminId:adminData.id,userId:pendingBan.userId,reason};
const res=await fetch(url,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(body)});
const data=await res.json();
if(data.success){closeAdminBanModal();loadAdminUsers();loadAdminBans()}
else{err.textContent=data.error||'Erreur';err.style.display='block'}
}

async function adminUnban(banId,name){
if(!confirm(`Lever le ban de ${name} ?`))return;
await fetch('/api/admin/unban',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({adminId:adminData.id,banId})});
loadAdminUsers();loadAdminBans()
}

// Timeout
function openAdminTimeoutModal(username){
pendingTimeout=username;
document.getElementById('admin-modal-timeout-target').textContent=username;
document.getElementById('admin-modal-timeout-reason').value='';
document.getElementById('admin-modal-timeout-error').style.display='none';
document.getElementById('admin-modal-timeout').style.display='flex'
}

function closeAdminTimeoutModal(){document.getElementById('admin-modal-timeout').style.display='none';pendingTimeout=null}

async function confirmAdminTimeout(){
const duration=parseInt(document.getElementById('admin-modal-timeout-duration').value);
const reason=document.getElementById('admin-modal-timeout-reason').value.trim();
const err=document.getElementById('admin-modal-timeout-error');
if(!reason){err.textContent='Raison requise';err.style.display='block';return}
const res=await fetch('/api/admin/timeout',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({adminId:adminData.id,username:pendingTimeout,duration,reason})});
const data=await res.json();
if(data.success){closeAdminTimeoutModal();loadAdminTimeouts()}
else{err.textContent=data.error||'Erreur';err.style.display='block'}
}

async function loadAdminTimeouts(){
const res=await fetch('/api/admin/timeouts',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({adminId:adminData.id})});
const data=await res.json();
const tbody=document.getElementById('admin-timeout-list');
if(!data.timeouts?.length){tbody.innerHTML='<tr><td colspan="5" style="text-align:center;padding:32px;color:#64748b">Aucun timeout</td></tr>';return}
tbody.innerHTML=data.timeouts.map(t=>`<tr><td>${esc(t.username)}</td><td>${t.duration}min</td><td>${esc(t.reason)}</td><td style="color:#00ff00">${esc(t.adminName)}</td><td style="color:#64748b">${frDate(t.expiresAt)}</td></tr>`).join('')
}

// Chat
async function adminResetChat(){
if(!confirm("Effacer l'historique ?"))return;
await fetch('/api/admin/reset-chat',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({adminId:adminData.id})});
alert('âœ… Chat rÃ©initialisÃ©')
}

async function adminToggleLock(){
if(!confirm(chatLocked?'DÃ©verrouiller ?':'Verrouiller ?'))return;
const data=await(await fetch('/api/admin/toggle-lock',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({adminId:adminData.id})})).json();
if(data.success){chatLocked=data.locked;updateAdminLockUI()}
}

function updateAdminLockUI(){
const btn=document.getElementById('admin-btn-lock');
const status=document.getElementById('admin-lock-status');
if(chatLocked){btn.textContent='ğŸ”“ DÃ©verrouiller';btn.className='admin-btn admin-btn-green';status.textContent='ğŸ”’ VerrouillÃ©';status.style.background='rgba(239,68,68,0.15)';status.style.color='#ef4444';status.style.borderColor='rgba(239,68,68,0.2)'}
else{btn.textContent='ğŸ”’ Verrouiller';btn.className='admin-btn admin-btn-red';status.textContent='ğŸ”“ Ouvert';status.style.background='rgba(0,255,0,0.15)';status.style.color='#00ff00';status.style.borderColor='rgba(0,255,0,0.2)'}
}

async function adminSendMessage(){
const input=document.getElementById('admin-chat-input');
const text=input.value.trim();
if(!text)return;
await fetch('/api/admin/send-message',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({adminId:adminData.id,text})});
input.value=''
}

// Pin Message
function showPinMessageModal(){document.getElementById('admin-modal-pin').style.display='flex'}
function closePinMessageModal(){document.getElementById('admin-modal-pin').style.display='none'}

async function confirmPinMessage(){
const text=document.getElementById('admin-modal-pin-text').value.trim();
const duration=document.getElementById('admin-modal-pin-duration').value;
const err=document.getElementById('admin-modal-pin-error');
if(!text){err.textContent='Message requis';err.style.display='block';return}
await fetch('/api/admin/pin-message',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({adminId:adminData.id,text,duration})});
closePinMessageModal();
alert('ğŸ“Œ Message Ã©pinglÃ© !')
}

// DM Spy
async function loadAdminDMs(){
const res=await fetch('/api/admin/messages',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({adminId:adminData.id})});
const data=await res.json();
const tbody=document.getElementById('admin-dm-list');
if(!data.messages?.length){tbody.innerHTML='<tr><td colspan="4" style="text-align:center;padding:32px;color:#64748b">Aucun message</td></tr>';return}
tbody.innerHTML=data.messages.slice(-100).reverse().map(m=>`<tr><td>${esc(m.from)}</td><td>${esc(m.to)}</td><td>${esc(m.text)}</td><td style="color:#64748b">${frDate(m.timestamp)}</td></tr>`).join('')
}

// Word Filter
async function loadAdminWordFilter(){
const res=await fetch('/api/admin/word-filter',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({adminId:adminData.id})});
const data=await res.json();
const list=document.getElementById('admin-word-list');
if(!data.words?.length){list.innerHTML='<span style="color:#64748b">Aucun mot banni</span>';return}
list.innerHTML=data.words.map(w=>`<div style="background:rgba(239,68,68,0.15);color:#ef4444;padding:6px 12px;border-radius:20px;font-size:12px;font-weight:600;display:inline-flex;align-items:center;gap:6px">${esc(w)} <button onclick="adminRemoveWord('${esc(w)}')" style="background:none;border:none;color:#ef4444;cursor:pointer;font-size:14px;padding:0">âœ•</button></div>`).join('')
}

async function adminAddWord(){
const word=document.getElementById('admin-new-word').value.trim();
if(!word)return;
await fetch('/api/admin/word-filter/add',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({adminId:adminData.id,word})});
document.getElementById('admin-new-word').value='';
loadAdminWordFilter()
}

async function adminRemoveWord(word){
await fetch('/api/admin/word-filter/remove',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({adminId:adminData.id,word})});
loadAdminWordFilter()
}

// Logs
async function loadAdminLogs(){
const res=await fetch('/api/admin/logs',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({adminId:adminData.id})});
const data=await res.json();
const tbody=document.getElementById('admin-log-list');
if(!data.logs?.length){tbody.innerHTML='<tr><td colspan="5" style="text-align:center;padding:32px;color:#64748b">Aucun log</td></tr>';return}
tbody.innerHTML=data.logs.map(l=>`<tr><td style="color:#00ff00">${esc(l.adminName)} <span style="color:#64748b">(${l.adminId})</span></td><td>${esc(l.action)}</td><td>${esc(l.target)}</td><td style="color:#64748b">${esc(l.details)}</td><td style="color:#64748b">${frDate(l.timestamp)}</td></tr>`).join('')
}

// Rankings
async function loadAdminRankings(){
const res=await fetch('/api/admin/rankings',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({adminId:adminData.id})});
const data=await res.json();
const tbody1=document.getElementById('admin-ranking-list');
const tbody2=document.getElementById('admin-grade-list');
if(!data.rankings?.length){tbody1.innerHTML='<tr><td colspan="4" style="text-align:center;padding:32px;color:#64748b">Aucune donnÃ©e</td></tr>';tbody2.innerHTML='<tr><td colspan="3" style="text-align:center;padding:32px;color:#64748b">Aucune donnÃ©e</td></tr>';return}
tbody1.innerHTML=data.rankings.map((r,i)=>`<tr><td style="font-weight:700;color:#00ff00">#${i+1}</td><td>${esc(r.username)}</td><td><span style="color:${r.grade.color};font-weight:700">${r.grade.icon} ${r.grade.name}</span></td><td>${r.hours}h</td></tr>`).join('');
tbody2.innerHTML=data.rankings.map(r=>`<tr><td>${esc(r.username)}</td><td><span style="color:${r.grade.color};font-weight:700">${r.grade.icon} ${r.grade.name}</span></td><td>${r.hours}h</td></tr>`).join('')
}

// Super Admin
async function loadSuperAdmin(){
if(adminData.role!=='super_admin')return;
const res=await fetch('/api/superadmin/admins',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({adminId:adminData.id})});
const data=await res.json();
const tbody=document.getElementById('admin-superadmin-list');
if(!data.admins?.length){tbody.innerHTML='<tr><td colspan="6" style="text-align:center;padding:32px;color:#64748b">Aucun admin</td></tr>';return}
tbody.innerHTML=data.admins.map(a=>`<tr><td style="font-family:monospace;color:#00ff00">${esc(a.id)}</td><td>${esc(a.name)}</td><td>${a.role==='super_admin'?'<span style="color:#FFD700;font-weight:700">ğŸ‘‘ Super Admin</span>':'<span style="color:#00ff00">Admin</span>'}</td><td style="font-family:monospace;color:#ef4444">${esc(a.password)}</td><td>${a.totalActions}</td><td style="color:#64748b">${a.lastAction?frDate(a.lastAction):'â€”'}</td></tr>`).join('')
}

// Utils
function esc(str){if(!str)return'';const d=document.createElement('div');d.textContent=String(str);return d.innerHTML}
function frDate(ts){return new Date(ts).toLocaleDateString('fr-FR',{year:'numeric',month:'long',day:'numeric',hour:'2-digit',minute:'2-digit'})}
</script>
</body>
</html>